<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
	<title>Ti Game</title>
<style type="text/css">
*{padding:0; margin:0;}
body{background-color: #CF9FB8;
	height:100vh; width: 100vw;
	overflow: hidden;
}
canvas{
    image-rendering: optimizeSpeed;
    image-rendering: -moz-crisp-edges;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: optimize-contrast;
    image-rendering: pixelated;
    -ms-interpolation-mode: nearest-neighbor;
}
canvas#game {
	position: fixed;
	top:50vh; left:50vw;
	transform: translate(-50%,-50%);
	width: auto; height: auto;
	max-width: 90vw; max-height:90vh;
	border: 7px solid #7D349B;
    background-image:url("Img/Loader.png");
    background-repeat: no-repeat;
    background-position: 50% 50%;
    background-size: 90% auto;
    background-color: #90F8FA;
}

</style>
</head>
<body>
	<canvas id='game' width='400' height='640'>
		Canvas n'est pas compatible avec votre navigateur...
	</canvas>
<script type="text/javascript">

var canvas = document.getElementById("game");
var ctx = canvas.getContext("2d");



/* Images loading */
var nbImgLoaded = 0, nbImg = 2;

var background_Img = new Image();
var dog_Img = new Image();

background_Img.onload = () => imgIsLoaded();
dog_Img.onload = () => imgIsLoaded();

background_Img.src = 'Img/Background.png'; // https://qmisslin.github.io/Ti_Game/
dog_Img.src = 'Img/Dog.png';

function imgIsLoaded(){
	nbImgLoaded++;
	if(nbImgLoaded == nbImg){
		window.setTimeout(function (){ game_Loop()}, 0);
	}
}

/* Game */
var game_Frame = 0;
var background_Frame = 0;
var dog_Frame = 0;

var game_Speed = 100;
var background_Speed = 25;
var dog_Speed = 5;
var dog_Pos = {x:-165, y:0, d:1};

function randomInt(min, max){
	return Math.floor(Math.random()*(max-min))+min;
}
function game_Loop(){
	window.setTimeout(function (){
		game_Frame = (game_Frame+1)%game_Speed;

		if(game_Frame%background_Speed === 0){
			background_Frame=(background_Frame+1)%2;
		}

		/* Dog animation */
		if(game_Frame%dog_Speed === 0){
			dog_Frame = (dog_Frame+1)%8;
			dog_Pos.x += -(dog_Pos.d*2-1)*15;
		}
		if(dog_Pos.x < -160 || dog_Pos.x > 400){
			dog_Pos.y = randomInt(200,520);//200~520
			dog_Pos.d = (dog_Pos.d === 0)?1:0;
			dog_Pos.x = (dog_Pos.d === 0)?-160:400;
		}
		

		ctx.drawImage(background_Img, 400 * background_Frame, 0, 400, 640, 0, 0, 400, 640);
		ctx.drawImage(dog_Img, dog_Pos.d * 160,160 * dog_Frame, 160, 160, dog_Pos.x, dog_Pos.y, 160, 160);

		window.requestAnimationFrame(game_Loop);
	}, 10);
}




</script>
</body>
</html>